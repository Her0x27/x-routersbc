{{define "content"}}
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">Network Configuration</h2>
                <div class="text-muted mt-1">Manage network interfaces, routing, and firewall settings</div>
            </div>
            <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                    <a href="#" class="btn btn-primary d-none d-sm-inline-block" onclick="refreshNetworkStatus()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                            <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                        </svg>
                        Refresh Status
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="page-body">
    <div class="container-xl">
        <!-- Network Status Cards -->
        <div class="row row-deck row-cards mb-3">
            <div class="col-sm-6 col-lg-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">WAN Status</div>
                            <div class="ms-auto">
                                <span class="status-indicator status-green" id="wan-status"></span>
                            </div>
                        </div>
                        <div class="h1 mb-3" id="wan-ip">Detecting...</div>
                        <div class="d-flex mb-2">
                            <div>Interface:</div>
                            <div class="ms-auto" id="wan-interface">-</div>
                        </div>
                        <div class="d-flex">
                            <div>Gateway:</div>
                            <div class="ms-auto" id="wan-gateway">-</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">LAN Status</div>
                            <div class="ms-auto">
                                <span class="status-indicator status-green" id="lan-status"></span>
                            </div>
                        </div>
                        <div class="h1 mb-3" id="lan-ip">192.168.1.1</div>
                        <div class="d-flex mb-2">
                            <div>DHCP:</div>
                            <div class="ms-auto" id="dhcp-status">Enabled</div>
                        </div>
                        <div class="d-flex">
                            <div>Clients:</div>
                            <div class="ms-auto" id="dhcp-clients">0</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">Wireless</div>
                            <div class="ms-auto">
                                <span class="status-indicator status-yellow" id="wireless-status"></span>
                            </div>
                        </div>
                        <div class="h1 mb-3" id="wireless-clients">0</div>
                        <div class="d-flex mb-2">
                            <div>AP Mode:</div>
                            <div class="ms-auto" id="ap-status">Disabled</div>
                        </div>
                        <div class="d-flex">
                            <div>STA Mode:</div>
                            <div class="ms-auto" id="sta-status">Disabled</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">Firewall</div>
                            <div class="ms-auto">
                                <span class="status-indicator status-green" id="firewall-status"></span>
                            </div>
                        </div>
                        <div class="h1 mb-3" id="firewall-rules">0</div>
                        <div class="d-flex mb-2">
                            <div>Backend:</div>
                            <div class="ms-auto" id="firewall-backend">-</div>
                        </div>
                        <div class="d-flex">
                            <div>Policy:</div>
                            <div class="ms-auto" id="firewall-policy">Accept</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Navigation -->
        <div class="row row-cards">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Network Configuration</h3>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="/network/interfaces" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <rect x="3" y="3" width="6" height="6" rx="1"/>
                                        <rect x="15" y="3" width="6" height="6" rx="1"/>
                                        <rect x="9" y="15" width="6" height="6" rx="1"/>
                                        <path d="M6 9v1a2 2 0 0 0 2 2h1"/>
                                        <path d="M18 9v1a2 2 0 0 1 -2 2h-1"/>
                                        <path d="M12 12v3"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">Network Interfaces</div>
                                    <div class="text-muted">Manage physical, VLAN, and VPN interfaces</div>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-blue" id="interfaces-count">0</span>
                                </div>
                            </div>
                        </a>
                        <a href="/network/wan" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <circle cx="12" cy="12" r="9"/>
                                        <path d="M8 12h8"/>
                                        <path d="M12 8v8"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">WAN Configuration</div>
                                    <div class="text-muted">Configure internet connection settings</div>
                                </div>
                            </div>
                        </a>
                        <a href="/network/lan" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <rect x="3" y="4" width="18" height="8" rx="3"/>
                                        <path d="M12 8h0"/>
                                        <path d="M7 16v4"/>
                                        <path d="M17 16v4"/>
                                        <path d="M7 20h10"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">LAN Configuration</div>
                                    <div class="text-muted">DHCP, DNS, and bridge settings</div>
                                </div>
                            </div>
                        </a>
                        <a href="/network/wireless" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M12 18h.01"/>
                                        <path d="M9.172 15.172a4 4 0 0 1 5.656 0"/>
                                        <path d="M6.343 12.343a8 8 0 0 1 11.314 0"/>
                                        <path d="M3.515 9.515c4.686 -4.687 12.284 -4.687 17 0"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">Wireless Settings</div>
                                    <div class="text-muted">WiFi access point and client configuration</div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Advanced Configuration</h3>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="/network/routing" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <circle cx="6" cy="19" r="2"/>
                                        <circle cx="18" cy="5" r="2"/>
                                        <path d="M12 19h4.5c.71 0 1.388 -.168 2.5 -.5"/>
                                        <path d="M12 5h-4.5c-.71 0 -1.388 .168 -2.5 .5"/>
                                        <path d="M12 5v14"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">Routing & UPnP</div>
                                    <div class="text-muted">Static routes and port mapping</div>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-green" id="routes-count">0</span>
                                </div>
                            </div>
                        </a>
                        <a href="/network/firewall" class="list-group-item list-group-item-action">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"/>
                                        <path d="M9 12l2 2l4 -4"/>
                                    </svg>
                                </div>
                                <div class="col">
                                    <div class="font-weight-medium">Firewall Rules</div>
                                    <div class="text-muted">Traffic filtering and NAT configuration</div>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-red" id="firewall-rules-count">0</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Activity Chart -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Network Activity</h3>
                        <div class="card-actions">
                            <a href="#" class="btn btn-outline-primary btn-sm" onclick="toggleActivityChart()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M3 12h4l3 8l4 -16l3 8h4"/>
                                </svg>
                                Toggle Chart
                            </a>
                        </div>
                    </div>
                    <div class="card-body" id="networkActivityChart" style="height: 200px; display: none;">
                        <div class="text-center text-muted">
                            <p>Real-time network activity monitoring will be displayed here</p>
                            <small>Data will be updated via WebSocket connection</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function refreshNetworkStatus() {
    // This will be implemented to refresh network status via WebSocket
    if (window.ws && window.ws.readyState === WebSocket.OPEN) {
        window.ws.send(JSON.stringify({
            type: 'get_network_status'
        }));
    }
}

function toggleActivityChart() {
    const chart = document.getElementById('networkActivityChart');
    if (chart.style.display === 'none') {
        chart.style.display = 'block';
    } else {
        chart.style.display = 'none';
    }
}

// Update status indicators based on WebSocket data
function updateNetworkStatus(data) {
    if (data.wan) {
        document.getElementById('wan-ip').textContent = data.wan.ip || 'No Connection';
        document.getElementById('wan-interface').textContent = data.wan.interface || '-';
        document.getElementById('wan-gateway').textContent = data.wan.gateway || '-';
        
        const wanStatus = document.getElementById('wan-status');
        if (data.wan.connected) {
            wanStatus.className = 'status-indicator status-green';
        } else {
            wanStatus.className = 'status-indicator status-red';
        }
    }
    
    if (data.lan) {
        document.getElementById('lan-ip').textContent = data.lan.ip || '192.168.1.1';
        document.getElementById('dhcp-status').textContent = data.lan.dhcp_enabled ? 'Enabled' : 'Disabled';
        document.getElementById('dhcp-clients').textContent = data.lan.active_leases || '0';
    }
    
    if (data.wireless) {
        document.getElementById('wireless-clients').textContent = data.wireless.clients || '0';
        document.getElementById('ap-status').textContent = data.wireless.ap_enabled ? 'Enabled' : 'Disabled';
        document.getElementById('sta-status').textContent = data.wireless.sta_enabled ? 'Enabled' : 'Disabled';
    }
    
    if (data.firewall) {
        document.getElementById('firewall-rules').textContent = data.firewall.rule_count || '0';
        document.getElementById('firewall-backend').textContent = data.firewall.backend || '-';
        document.getElementById('firewall-policy').textContent = data.firewall.policy || 'Accept';
        
        const firewallStatus = document.getElementById('firewall-status');
        if (data.firewall.status === 'active') {
            firewallStatus.className = 'status-indicator status-green';
        } else {
            firewallStatus.className = 'status-indicator status-yellow';
        }
    }
    
    // Update counts
    if (data.interfaces_count !== undefined) {
        document.getElementById('interfaces-count').textContent = data.interfaces_count;
    }
    
    if (data.routes_count !== undefined) {
        document.getElementById('routes-count').textContent = data.routes_count;
    }
    
    if (data.firewall_rules_count !== undefined) {
        document.getElementById('firewall-rules-count').textContent = data.firewall_rules_count;
    }
}

// Load initial status on page load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(refreshNetworkStatus, 1000);
});
</script>
{{end}}

{{template "layout.html" .}}
